var response = {
    "took": 35,
    "timed_out": false,
    "_shards": {
      "total": 220,
      "successful": 220,
      "skipped": 200,
      "failed": 0
    },
    "hits": {
      "total": 1314,
      "max_score": 0,
      "hits": []
    },
    "aggregations": {
      "2": {
        "doc_count_error_upper_bound": 0,
        "sum_other_doc_count": 0,
        "buckets": [
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.zem.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.zem.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata07",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.zem.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.zem.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata08",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata136-adm.rouen.francetelecom.fr",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata137-adm.rouen.francetelecom.fr",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata138-adm.rouen.francetelecom.fr",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata145",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.pbe.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.pbe.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata176",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.pbe.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.pbe.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata177",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.zem.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.zem.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata184",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.zem.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.zem.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata185",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.zem.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.zem.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata186",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.zem.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.zem.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata187",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster2/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster2/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbignifiam01",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster2/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster2/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbignifiam02",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster2/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster2/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbignifiam03",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster2/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster2/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbignifiam04",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.vrf.nificluster2/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.vrf.nificluster2/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbignifiam05",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.t2diod.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.t2diod.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigsdr01",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.t2diod.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.t2diod.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigsdr02",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.t2diod.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.t2diod.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigsdr03",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.fe.gin.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.fe.gin.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "sdrfenifi06",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.t2sio.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.t2sio.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "uabigdata128",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.t2sio.nificluster1/ListenHTTP",
                  "doc_count": 15
                },
                {
                  "key": "sdr.t2sio.nificluster1/GetFile",
                  "doc_count": 15
                }
              ]
            },
            "key": "uabigdata130.rouen.francetelecom.fr",
            "doc_count": 30
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.fe.gin.nificluster1/ListenHTTP",
                  "doc_count": 14
                },
                {
                  "key": "sdr.fe.gin.nificluster1/GetFile",
                  "doc_count": 14
                }
              ]
            },
            "key": "sdrfenifi04",
            "doc_count": 28
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.fe.gin.nificluster1/ListenHTTP",
                  "doc_count": 14
                },
                {
                  "key": "sdr.fe.gin.nificluster1/GetFile",
                  "doc_count": 14
                }
              ]
            },
            "key": "sdrfenifi05",
            "doc_count": 28
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "BTD-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "CDN-550-2",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "COSMICS-600-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "DIODMIN-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "DIODMIN-550-2",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "DSH-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "ITALogs-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "SCF-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "Suricate-AM-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "Suricate-AM-550-2",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "Suricate-AM-550-3",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "Suricate621-621-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "TBS-P-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "TEST_Didier-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "TKT_AUDIP-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "Wassup-600-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "KAFKA_cluster_CDN",
                  "doc_count": 15
                }
              ]
            },
            "key": "opbigdata137-adm",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00027-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00116-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00116RD-600-rc1-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00125-2-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00125-3-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00125-4-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00137-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00143-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00147-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p00159-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p16064-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p16068-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p17084-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p17122-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p99999A-600-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "p99999D-550-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 15
                }
              ]
            },
            "key": "pc18150-624-1",
            "doc_count": 15
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 14
                }
              ]
            },
            "key": "SMARTGIDF-550-1",
            "doc_count": 14
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "DIOD Kibana Service",
                  "doc_count": 14
                }
              ]
            },
            "key": "p18144-550-1",
            "doc_count": 14
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.fe.internet.nificluster1/ListenHTTP",
                  "doc_count": 5
                },
                {
                  "key": "sdr.fe.internet.nificluster1/GetFile",
                  "doc_count": 5
                }
              ]
            },
            "key": "sdr-nifi-01",
            "doc_count": 10
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.fe.internet.nificluster1/ListenHTTP",
                  "doc_count": 5
                },
                {
                  "key": "sdr.fe.internet.nificluster1/GetFile",
                  "doc_count": 5
                }
              ]
            },
            "key": "sdr-nifi-02",
            "doc_count": 10
          },
          {
            "3": {
              "doc_count_error_upper_bound": 0,
              "sum_other_doc_count": 0,
              "buckets": [
                {
                  "key": "sdr.fe.internet.nificluster1/ListenHTTP",
                  "doc_count": 5
                },
                {
                  "key": "sdr.fe.internet.nificluster1/GetFile",
                  "doc_count": 5
                }
              ]
            },
            "key": "sdr-nifi-03",
            "doc_count": 10
          }
        ]
      }
    }
  };

//*******function to flatt object JSON***********
function flattenJSON (data) {
	var result = {};
	function recurse (cur, prop) {
		if (Object(cur) !== cur) {
			result[prop] = cur;
		} else if (Array.isArray(cur)) {
			 for(var i=0, l=cur.length; i<l; i++)
				 recurse(cur[i], prop + "[" + i + "]");
			if (l == 0)
				result[prop] = [];
		} else {
			var isEmpty = true;
			for (var p in cur) {
				isEmpty = false;
				recurse(cur[p], prop ? prop+"."+p : p);
			}
			if (isEmpty)
				result[prop] = {};
		}
	}
	recurse(data, "");
	return result;
};

function createLinks(response){
  var responseFlatt = flattenJSON(response);
  var bucketsNode = response.aggregations[2].buckets;
  var type = "suit";
  var links = [];
  for (var i in bucketsNode){
      var obj = {};
      var node = response.aggregations[2].buckets[i].key;
      var bucketcluster = response.aggregations[2].buckets[i][3].buckets;

        for(var j in bucketcluster){
          var cluster = response.aggregations[2].buckets[i][3].buckets[j].key;
          //console.log(j +"     " + cluster)
          obj["source"] = node;
          obj["target"] = cluster;
          obj["type"] = type;
          //console.log(JSON.stringify(obj));
          links.push(obj);
        }
  
  }console.log(JSON.stringify(links));
  return links;
}

